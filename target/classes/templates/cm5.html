<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>网元投诉分析</title>
<!--    <link rel="stylesheet" href="../static/css/bootstrap.min.css">-->
<!--    <link rel="stylesheet"  href="../static/css/bootstrap-datetimepicker.min.css">-->
<!--    <link rel="stylesheet" href="../static/css/bootstrap-theme.min.css">-->
<!--    <script src="../static/js/jquery-1.11.3.min.js"></script>-->
<!--    <script src="../static/js/bootstrap.min.js"></script>-->
<!--    <script src="../static/js/echarts.min.js"></script>-->
<!--    <script src="../static/js/jquery.js"></script>-->
<!--    <script src="../static/js/bootstrap-datetimepicker.min.js"></script>-->
<!--    <script src="../static/js/moment-with-locales.js"></script>-->

    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="/css/bootstrap-datetimepicker.min.css">
    <script src="/js/jquery-1.11.3.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/echarts.min.js"></script>
    <script src="/js/jquery.js"></script>
    <script src="/js/moment-with-locales.js"></script>
    <script src="/js/bootstrap-datetimepicker.min.js"></script>
    <script src="/js/ecStat.min.js"></script>




    <script>
        window.onload=function(){

            document.getElementById("btn").click();

        }
    </script>





    <!--    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>-->
<!--    <link href="https://cdn.bootcss.com/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css" rel="stylesheet">-->
<!--    <script src="https://cdn.bootcss.com/moment.js/2.22.0/moment-with-locales.js"></script>-->
<!--    <script src="https://cdn.bootcss.com/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>-->

    <style type="text/css">
        .myrow {
            display: flex;
            flex-direction: row;
            /*margin-left:1em;*/
        }

        .xxxx {
            height: 2px;
            background: #999999;
            margin-top: 16px;
            width: 1em;
            margin-left: 1em;
            margin-right: 1em;
        }
    </style>

        <style>
            .box {
                width: 1300px;
                height: 500px;
                background-color: white;
            }
        </style>

</head>
<body>

<div class="container">
    <div class="">
        <h2 align="center">网元投诉分析</small></h2>
    <div>

            <div class="dropdown" style="float: left">
                <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                    查看其它
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">

                    <li><a href="/user/cm1">区域维度分析</a></li>
                    <li><a href="/user/cm2">光交箱分析</a></li>
                    <li><a href="/user/cm3">装维及时率分析</a></li>
                    <li><a href="/user/cm4">装维满意度分析</a></li>
                    <li><a href="/user/cm6">小区事件分析</a></li>

                    <li role="separator" class="divider"></li>
                    <li><a href="/navigation">返回首页</a></li>
                </ul>
            </div>




<!--            <div class="" style="float: right">-->
<!--                <button class="btn btn-danger " type="button" id=""  aria-haspopup="true" aria-expanded="true">-->
<!--                    小区事件查看-->

<!--                </button>-->

<!--            </div>-->


            <div class="col-md-2" style="float: left" >
                <div class="input-group">
                    <div class="input-group-btn">
                        <a type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                           aria-haspopup="true" aria-expanded="false">类别 <span class="caret"></span></a>
                        <ul class="dropdown-menu" id="type"   th:method="get">
                            <li><a href="#"  >全部</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="#">电视</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="#">宽带</a></li>

                        </ul>
                    </div><!-- /btn-group -->
                    <form id="ttzz">
                        <input type="text" id="rt" class="form-control"  name="danyuan" value="全部" aria-label="..." placeholder="==请选择==">
                    </form>
                </div><!-- /input-group -->
            </div>


        <div class="col-md-2" style="float: left" >
            <div class="input-group">
                <div class="input-group-btn">
                    <a type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">展示形式 <span class="caret"></span></a>
                    <ul class="dropdown-menu" id="type1"   th:method="get">
                        <li><a href="#"  >饼图</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">柱状图</a></li>

                    </ul>
                </div><!-- /btn-group -->
                <form id="ttzz1">
                    <input type="text" id="rtz" class="form-control"  name="danyuan" value="饼图" aria-label="..." placeholder="==请选择==">
                </form>
            </div><!-- /input-group -->
        </div>





        </div>

    </div>

</div>

<script>
    $("#type").on("click", "li", function(){
        $("#rt").val($(this).text());
    });
</script>


<script>
    $("#type1").on("click", "li", function(){
        $("#rtz").val($(this).text());
    });
</script>

<hr>
<br>

<div class="container">

    <div class="row ">


        <div class="col-md-2" style="float: left" >
            <div class="input-group">
                <div class="input-group-btn">
                    <a type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">单元 <span class="caret"></span></a>
                    <ul class="dropdown-menu" id="dany" onclick="dany"  th:method="get">
                        <li><a href="#"  >市区分公司</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">新区分公司</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">丹徒分公司</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">丹阳分公司</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">扬中分公司</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">句容分公司</a></li>
                        <li role="separator" class="divider"></li>
                    </ul>
                </div><!-- /btn-group -->
                <form id="ccdy">
                <input type="text" id="dy_in" class="form-control"  name="danyuan" value="" aria-label="..." placeholder="==请选择==">
                </form>
            </div><!-- /input-group -->
        </div>

<!--        选择显示单元在inptu标签里-->
        <script>
            $("#dany").on("click", "li", function(){
                $("#dy_in").val($(this).text());
            });
        </script>


        <div class="col-md-2 " style="float: left">
            <div class="input-group">
                <div class="input-group-btn ">
                    <a type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false" >网格 <span class="caret"></span></a>
                    <ul class="dropdown-menu" id="wg" style="height:400px;overflow:scroll" >
                        <li><a href="#"  >梦溪区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >北固区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >南徐区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >宝塔区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >象山区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >金山区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >高新区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >谏壁区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >南山区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >市区校园区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >大港区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >丁北区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >丁南区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >丁岗区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >姚桥区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >宜城区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >高资区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >辛丰区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >谷阳区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >上党区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >宝堰区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >丹徒校园区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >丹阳丹北区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >丹阳曲阿区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >丹阳云阳区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >司徒区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >丹阳高新区区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >吕城区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >丹阳城西区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >皇塘区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >丹阳界牌区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >陵口区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >丹阳工业园区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >扬中城西区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >新坝区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >扬中城东区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >八桥区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >油坊区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >华阳区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >句容开发区区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >崇明区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >宝华区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >边白区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >下蜀区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >天王区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >茅山区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >郭庄区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#"  >后白区域中心</a></li>

                    </ul>
                </div><!-- /btn-group -->
                <form id="czwg">
                <input type="text"  class="form-control" id="wangge" value="" aria-label="..." placeholder="==请选择==">
                </form>

            </div><!-- /input-group -->
        </div>

        <!--        选择网格单元在inptu标签里-->
        <script>
            $("#wg").on("click", "li", function(){
                $("#wangge").val($(this).text());
            });
        </script>

        <script>
            $("#dany").on("click", "li", function(){
                var wgreact=window.document.getElementById("wg");
                var dan_y=document.getElementById("dy_in").value;
                var html1="";
                console.log(dan_y);
                console.log("ceshi");
                if (dan_y=="市区分公司"){
                    html1+=
                        '<li><a href="#"  >梦溪区域中心</a></li>\n' +
                        '               <li role="separator" class="divider"></li>\n' +
                        '               <li><a href="#"  >北固区域中心</a></li>\n' +
                        '               <li role="separator" class="divider"></li>\n' +
                        '               <li><a href="#"  >南徐区域中心</a></li>\n' +
                        '               <li role="separator" class="divider"></li>\n' +
                        '               <li><a href="#"  >宝塔区域中心</a></li>\n' +
                        '               <li role="separator" class="divider"></li>\n' +
                        '               <li><a href="#"  >象山区域中心</a></li>\n' +
                        '               <li role="separator" class="divider"></li>\n' +
                        '               <li><a href="#"  >金山区域中心</a></li>\n' +
                        '               <li role="separator" class="divider"></li>\n' +
                        '               <li><a href="#"  >高新区域中心</a></li>\n' +
                        '               <li role="separator" class="divider"></li>\n' +
                        '               <li><a href="#"  >谏壁区域中心</a></li>\n' +
                        '               <li role="separator" class="divider"></li>\n' +
                        '               <li><a href="#"  >南山区域中心</a></li>\n' +
                        '               <li role="separator" class="divider"></li>\n' +
                        '               <li><a href="#"  >市区校园区域中心</a></li>\n' +
                        '               <li role="separator" class="divider"></li>';
                    wgreact.innerHTML=html1;
                } else if (dan_y=="新区分公司"){
                    html1+='<li><a href="#"  >大港区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >丁北区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >丁南区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >丁岗区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >姚桥区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>';
                    wgreact.innerHTML=html1;

                } else if (dan_y=="丹徒分公司"){
                    html1+='<li><a href="#"  >宜城区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >高资区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >辛丰区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >谷阳区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >上党区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >宝堰区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >丹徒校园区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>';
                    wgreact.innerHTML=html1;
                }else if (dan_y=="丹阳分公司"){
                    html1+='<li><a href="#"  >丹阳丹北区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >丹阳曲阿区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >丹阳云阳区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >司徒区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >丹阳高新区区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >吕城区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >丹阳城西区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >皇塘区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >丹阳界牌区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >陵口区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >丹阳工业园区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>';
                    wgreact.innerHTML=html1;
                }else if (dan_y=="扬中分公司"){
                    html1+='<li><a href="#"  >扬中城西区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >新坝区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >扬中城东区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >八桥区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >油坊区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>';
                    wgreact.innerHTML=html1;
                }else if (dan_y=="句容分公司"){
                    html1+='<li><a href="#"  >华阳区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >句容开发区区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >崇明区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >宝华区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >边白区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >下蜀区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >天王区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >茅山区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >郭庄区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >后白区域中心</a></li>';
                    wgreact.innerHTML=html1;
                }

            });
        </script>



        <div class="input-group col-md-2" style="float: left">
            <span class="input-group-addon" id="sizing-addon2">小区</span>
            <form id="xiaoqu">
            <input type="text" class="form-control" id="xiaoqu_in" name="comm" placeholder="请输入小区名" aria-describedby="sizing-addon2">
            </form>
        </div>






        <div class=" col-md-3 " role="group" aria-label="..." style="float: left">
            <button type="button" id="btn" tag="cbtn" class="btn btn-primary" onclick="">查询</button>
            <button type="button" class="btn btn-info" onclick="formReset()" value="Reset form" >重置</button>
            <button class="btn btn-success" data-target="#myModal" data-toggle="modal">
                投诉网元
            </button>


            <!--            点击按钮获取参数到后端-->

            <script>
                function formReset()
                {
                    document.getElementById("ccdy").reset();
                    document.getElementById("czwg").reset();
                    document.getElementById("xiaoqu").reset();
                }

            </script>


            <a class="btn btn-warning" >
                日期
            </a>
            <!--fade 淡入淡出-->
            <div class="modal fade" id="myModal" aria-labelledby="myModallabel" aria-hidden="true" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">

                        <div class="modal-header">
                            <button class="close" type="button" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h5 class="modal-title" id="myModallabel " style="margin: auto;">投诉网元分析</h5>
                        </div>

                        <form id="formData" class="form-horizontal" >

<!--                            <div class="modal-body">-->
<!--                                <div class="form-group ">-->
<!--                                    <form>-->
<!--                                        <div class="form-group" style="margin: auto;">-->

<!--                                            <input type="file" id="exampleInputFile">-->

<!--                                        </div>-->
<!--                                    </form>-->
<!--                                </div>-->

<!--                            </div>-->

                            <div>
                                <br>

                               <p> <b>一级原因：</b>

                                    <div id="first">

                                    </div>
                               </p>
                                <br>

                                <p><b>二级原因：</b>


                                    <div id="second">

                                    </div>
                                </p>
                                <br>

                            </div>

                            <div class="modal-footer">
<!--                                <button class="btn btn-success" type="button" onclick="">提交</button>-->
                                <button class="btn btn-danger" type="button" data-dismiss="modal">关闭</button>
                            </div>

                        </form>


                    </div>
                </div>
            </div>



        </div>



        <!--=====================时间组件=====================-->


        <div class="form-group col-md-3 " style="float: left">


            <div class="myrow">

                <div class='input-group date' style="width: 10em;" id='datetimepicker1'>
                    <input type='text' id="start_time" naem="start_time" class="timeInput form-control" style="width: 100px" />
                    <span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                    </span>
                </div>
                <div class="xxxx">

                </div>
                <div class='input-group date' style="width: 10em;" id='datetimepicker2'>
                    <input type='text' id="end_time" name="end_time" class="timeInput form-control" style="width: 100px" />
                    <span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                    </span>
                </div>
            </div>
        </div>



        <script>
            $(function() {
                $('#form1').hide();
                var picker1 = $('#datetimepicker1').datetimepicker({
                    format: 'YYYY-MM-DD',
                    locale: moment.locale('zh-cn'),
                    //minDate: '2016-7-1'
                });
                var picker2 = $('#datetimepicker2').datetimepicker({
                    format: 'YYYY-MM-DD',
                    locale: moment.locale('zh-cn')
                });
                //动态设置最小值
                picker1.on('dp.change', function(e) {
                    picker2.data('DateTimePicker').minDate(e.date);
                });
                //动态设置最大值
                picker2.on('dp.change', function(e) {
                    picker1.data('DateTimePicker').maxDate(e.date);
                });
            });
            $('#datetimepicker1').datetimepicker({
                format: 'YYYY-MM-DD',
                locale: moment.locale('zh-cn'),
                defaultDate: "2020-11-01"
            });
            $('#datetimepicker2').datetimepicker({
                format: 'YYYY-MM-DD',
                locale: moment.locale('zh-cn'),
                defaultDate: "2020-11-10"
            });
        </script>


        <!--=====================时间组件=====================-->


    </div><!-- /.row -->

</div>
<br>
<br>
<div class="box container-fluid   " id="main" style="height:650px" ></div>

<br>
<br>
<!--================end================-->
<div class="container" >
    <table class="table table-bordered">
        <caption>小区工单万投比TOP50
            <button style="float: right" class="btn btn-success" type="btn" id="btn2">数据导出</button>
        </caption>



        <thead>
        <tr bgcolor="#1e90ff" >
            <th class="text-center">单元</th>
            <th class="text-center">区域中心</th>
            <th class="text-center">代维单位</th>
            <th class="text-center">小区名称</th>
            <th class="text-center">小区ID</th>
            <th class="text-center">投诉工单量</th>
            <th class="text-center">在网用户数（管线）</th>
            <th class="text-center">广义万投比</th>
        </tr>
        </thead>




        <tbody id="tbody-result">






        </tbody>



    </table>


</div>




    <script type="text/javascript"  th:inline="javascript">



       var myChart = echarts.init(document.querySelector(".box"));

       var btn = document.getElementById("btn");
       var btn2 = document.getElementById("btn2")


       var url=decodeURIComponent(window.location.search);


       if (url.indexOf("&")!=-1){
           var urlxiaoqu = window.location.search.split("&")[0].split("=")[1];
           urlxiaoqu = decodeURIComponent(urlxiaoqu);
           $("#xiaoqu_in").val(urlxiaoqu);


           var urlstart_time = window.location.search.split("&")[1].split("=")[1];
           $("#start_time").val(urlstart_time);

           var urlend_time = window.location.search.split("&")[2].split("=")[1];
           $("#end_time").val(urlend_time);


           // console.log("小区",xiaoqu);
           // console.log("urlstart_time",urlstart_time);
           // console.log("urlstart_time",urlend_time);

       }


       // var url=decodeURIComponent(window.location.search);
       // alert(url);


       btn.onclick=
           function () {

           var ajaxObj= new XMLHttpRequest();
           // 单元
           var dan_y = document.getElementById("dy_in").value;
           // 区域中心
           var wang_ge = document.getElementById("wangge").value;
           //小区
           var xiaoqu_in = document.getElementById("xiaoqu_in").value;


           // 开始时间
           var start_time = document.getElementById("start_time").value;
           // 结束时间
           var end_time = document.getElementById("end_time").value;

           var rt = document.getElementById("rt").value;

           var rtz = document.getElementById("rtz").value;

           var rt1="";

            if (rt=="全部"){
                rt1="%25";
            }else {
                if (rt=="宽带"){
                    rt1="宽带";
                }else {
                    rt1="电视";
                }

            }

           // alert(end_time);
            console.log(xiaoqu_in=="");

           // ==========返回前端数据==============

            stime = document.getElementById("start_time").value; //开始日期
            etime = document.getElementById("end_time").value; //结束日期


           getdiffdate(stime,etime);
           //获取两日期之间日期列表函数

           //获取两日期之间日期列表函数
           function getdiffdate(stime,etime){
               //初始化日期列表，数组
               var diffdate = new Array();
               var i=0;
               var arrday=[];
               //开始日期小于等于结束日期,并循环
               while(stime<=etime){
                   diffdate[i] = stime;

                   //获取开始日期时间戳

                   arrday.push(stime);
                   var stime_ts = new Date(stime).getTime();
                   // console.log('当前日期：'+stime   +'当前时间戳：'+stime_ts);

                   //增加一天时间戳后的日期
                   var next_date = stime_ts + (24*60*60*1000);

                   //拼接年月日，这里的月份会返回（0-11），所以要+1
                   var next_dates_y = new Date(next_date).getFullYear()+'-';
                   var next_dates_m = (new Date(next_date).getMonth()+1 < 10)?'0'+(new Date(next_date).getMonth()+1)+'-':(new Date(next_date).getMonth()+1)+'-';
                   var next_dates_d = (new Date(next_date).getDate() < 10)?'0'+new Date(next_date).getDate():new Date(next_date).getDate();

                   stime = next_dates_y+next_dates_m+next_dates_d;

                   //增加数组key
                   i++;
               }
               // console.log(diffdate);
               // alert(arrday);
               return arrday;
           }






           $.get('/data4?start_time='+start_time+'&end_time='+end_time
               +'&dan_y='+dan_y+'&wang_ge='+wang_ge+'&xiaoqu_in='+xiaoqu_in+'&rt='+rt+'&rt1='+rt1 , function (res) {
               if(res) {

                   col=res.workSheets;
                   console.log("表格",col);
                   coo=res.workSheet1s;
                   console.log("查询结果",coo);

                   var arr1=[];
                   for (let e1 of coo) {
                       arr1.push(e1.kind1);
                   }
                   console.log("二级原因",arr1);


                   var arr11=[];
                   for (let e1 of coo) {
                       arr11.push(e1.num1);
                   }



                   var arr2=[];
                   for (let e2 of coo) {
                       arr2.push(e2.num1);
                   }


                   var data1=[];

                   for(var i=0;i<coo.length;i++){

                       data1.push({ name: coo[i].kind2, value: coo[i].num2});
                   }

                   console.log("data1",data1);

                   var data11=[];
                   for(var i=0;i<coo.length;i++){

                       data11.push( coo[i].num2);
                   }


                   // 相同项合并求和

                   var result={};

                   for(i=0;i<data1.length;i++){
                       if(result[data1[i].name]){
                           result[data1[i].name]+=data1[i].value;
                       }else{
                           result[data1[i].name]=data1[i].value;
                       }
                   }
                   console.log("result",result)

                   var keyvalue=[];


                   for(var key in result){
                       keyvalue.push({name:key,value:result[key]})
                   }
                   console.log("keyvalue",keyvalue);

                   var keyvalue_x=[];
                   var keyvalue_y=[];

                   for(var i=0;i<keyvalue.length;i++){
                       keyvalue_x.push(keyvalue[i].name)
                       keyvalue_y.push(keyvalue[i].value)
                   }


                   console.log("keyvalue_x",keyvalue_x);
                   console.log("keyvalue_y",keyvalue_y);


                   //计算数组所占百分比
                   function countPercentage(countArray){
                       var j = eval(countArray.join('+'));
                       var resultArray = [];
                       for (var i = 0 ; i < countArray.length ; i++){
                           var k = (countArray[i]*100/j).toFixed(2) + "%";
                           resultArray.push(k);
                       }
                       return resultArray;
                   }

                   var resultData = countPercentage(keyvalue_y);
                   console.log("resultData",resultData);



                   var keyvalue_xx=[];

                   var first_reason="";
                   for(var i=0;i<keyvalue.length;i++){

                       keyvalue_xx.push(keyvalue[i].name+"（"+resultData[i]+"）");

                       if (i==keyvalue.length-1){
                           mark="；";
                       } else{
                           mark="，"
                       }

                       first_reason+=keyvalue[i].name+"占比"+resultData[i]+mark;

                   }

                   console.log("keyvalue_xx",keyvalue_xx);

                   // alert(first_reason);














// =============================================
                   var data2=[];

                   sec=[];

                   for(var i=0;i<coo.length;i++){

                        data2.push({ value: coo[i].num1, name: coo[i].kind1});
                        sec.push(coo[i].num1);
                       }

                   console.log("data2",data2);
                   console.log("sec",sec);


                   var resultData1 = countPercentage(sec);

                   console.log("resultData1",resultData1);

                    var second_reason="";

                   for(var i=0;i<resultData1.length;i++){



                       if (i==resultData1.length-1){
                           mark="。";
                       } else{
                           mark="，"
                       }

                       second_reason+=coo[i].kind1+"占比"+resultData1[i]+mark;

                   }

                   var first=window.document.getElementById("first");

                   first.innerHTML=first_reason;

                   var second=window.document.getElementById("second");

                   second.innerHTML=second_reason;

                    // alert(second_reason);

                   // console.log(keyvalue.length);




                   // ============================

                   var tbody=window.document.getElementById("tbody-result");
                   var html = "";



                   for (var j in col) {
                       var obj = col[j];
                       html += '<tr>'
                       html += '<td class="text-center">' + obj.danyuan + '</td>';
                       html += '<td class="text-center">' + obj.wangge + '</td>';
                       html += '<td class="text-center">' + obj.dw + '</td>';
                       html += '<td class="text-center">' + obj.community + '</td>';
                       // html += '<td class="text-center">'+'<a href="">' + obj.id +'</a>'+ '</td>';
                       html += '<td class="text-center">'+ obj.id + '</td>';
                       html += '<td class="text-center">' + obj.cm + '</td>';
                       html += '<td class="text-center">' + obj.com_num + '</td>';
                       html += '<td class="text-center">' + obj.wtb + '</td>';
                       html += '</tr>'
                   }

                   // html += '</table>';
                   //
                   // $('#treeList1').append(html);
                   tbody.innerHTML = html;


                   // ============================




                   function unique (array){
                       return Array.from(new Set(array))
                   }


                   option = {
                       tooltip: {
                           trigger: 'item',
                           formatter: '{a} <br/>{b}: {c} ({d}%)'
                       },
                       legend: {
                           orient: 'vertical',
                           left: 0,
                           data: arr1
                       },
                       series: [
                           {
                               name: '一级原因',
                               type: 'pie',
                               selectedMode: 'single',
                               radius: [0, '30%'],

                               label: {
                                   position: 'inner'

                               },
                               labelLine: {
                                   show: false
                               },
                               data: keyvalue

                           },
                           {
                               name: '二级原因',
                               type: 'pie',
                               radius: ['40%', '55%'],
                               label: {
                                   formatter: '{a|{a}}{abg|}\n{hr|}\n  {b|{b}：}{c}  {per|{d}%}  ',
                                   backgroundColor: '#eee',
                                   borderColor: '#aaa',
                                   borderWidth: 1,
                                   borderRadius: 4,
                                   // shadowBlur:3,
                                   // shadowOffsetX: 2,
                                   // shadowOffsetY: 2,
                                   // shadowColor: '#999',
                                   // padding: [0, 7],
                                   rich: {
                                       a: {
                                           color: '#999',
                                           lineHeight: 22,
                                           align: 'center'
                                       },
                                       // abg: {
                                       //     backgroundColor: '#333',
                                       //     width: '100%',
                                       //     align: 'right',
                                       //     height: 22,
                                       //     borderRadius: [4, 4, 0, 0]
                                       // },
                                       hr: {
                                           borderColor: '#aaa',
                                           width: '100%',
                                           borderWidth: 0.5,
                                           height: 0
                                       },
                                       b: {
                                           fontSize: 10,
                                           lineHeight: 4
                                       },
                                       per: {
                                           color: '#eee',
                                           backgroundColor: '#334455',
                                           padding: [2, 4],
                                           borderRadius: 2
                                       }
                                   }
                               },
                               data: data2

                           }
                       ]
                   };
// =============================================
                   option2 = {
                       color: ['#3398DB'],
                       tooltip: {
                           trigger: 'axis',
                           axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                               type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                           }
                       },
                       grid: {
                           left: '3%',
                           right: '4%',
                           bottom: '3%',
                           containLabel: true
                       },
                       xAxis: [
                           {
                               type: 'category',
                               data: keyvalue_xx,
                               axisTick: {
                                   alignWithLabel: true
                               }
                           }
                       ],
                       yAxis: [
                           {
                               type: 'value'
                           }
                       ],


                       series: [
                           {
                               name: '投诉量',
                               type: 'bar',
                               barWidth: '60%',
                               label:{
                                   normal:{
                                       show: true,
                                       position:'top',
                                       textStyle:{
                                           fontSize:16,
                                           color:'#000000'
                                       },
                                       formatter: '{c}'
                                   }
                               },
                               data: keyvalue_y,


                           },
                       ]

                   };

                   if (rtz=="饼图"){
                       myChart.setOption(option,true);

                   }else{
                       myChart.setOption(option2,true);
                   }



               }
           });



           function changeURLPar(uri, par, par_value) {
               var pattern = par + '=([^&]*)';
               var replaceText = par + '=' + par_value;
               if (uri.match(pattern)) {//如果连接中带这个参数
                   var tmp = '/\\' + par + '=[^&]*/';
                   tmp = uri.replace(eval(tmp), replaceText);
                   return (tmp);
               }
               else {
                   if (uri.match('[\?]')) {//如果链接中不带这个参数但是有其他参数
                       return uri + '&' + replaceText;
                   }
                   else {//如果链接中没有带任何参数
                       return uri + '?' + replaceText;
                   }
               }
               return uri + '\n' + par + '\n' + par_value;
           }

           var newurl = changeURLPar(window.location.href, 'xiaoqu_in', xiaoqu_in);

           window.history.pushState(null,null,newurl);//向当前url添加参数

           var newurl1 = changeURLPar(window.location.href, 'start_time', start_time);

           window.history.pushState(null,null,newurl1);//向当前url添加参数

           var newurl2 = changeURLPar(window.location.href, 'end_time', end_time);

           window.history.pushState(null,null,newurl2);//向当前url添加参数

       }






// *************************




       // *************************











// ====================================


// ----------------------------------------
       btn2.onclick= function (){
                   // console.log(result);

                   //要导出的json数据
                   //列标题，逗号隔开，每一个逗号就是隔开一个单元格
                   let str = `单元,区域中心,代维单位,小区名称,小区ID,广义投诉量,在网用户数（管线）,广义万投比\n`;
                   //增加\t为了不让表格显示科学计数法或者其他格式
                   for(let i = 0 ; i < colall.length ; i++ ){
                       for(let item in colall[i]){
                           str+=`${colall[i][item] + '\t'},`;
                       }
                       str+='\n';
                   }
                   //encodeURIComponent解决中文乱码
                   let uri = 'data:text/csv;charset=utf-8,\ufeff' + encodeURIComponent(str);
                   //通过创建a标签实现
                   let link = document.createElement("a");
                   link.href = uri;
                   //对下载的文件命名
                   link.download =  stime+"至"+etime+ "小区万投比明细.csv";
                   document.body.appendChild(link);
                   link.click();
                   document.body.removeChild(link);

       }



    </script>




</body>
</html>
